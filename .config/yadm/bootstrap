#!/usr/bin/env bash

system_type=$(uname -s)

install_package() {
  if [ "$system_type" = "Darwin" ]; then
    brew install $1
  else
    yay -S --noconfirm --needed $1
  fi
}

setup_zsh() {
  install_package zsh
  sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" "" --keep-zshrc --unattended

  if [ ! -d "${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions" ]; then
    git clone https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions
  fi
  if [ ! -d "${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting" ]; then
    git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting
  fi
  if [ ! -d "${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/themes/powerlevel10k" ]; then
    git clone --depth=1 https://github.com/romkatv/powerlevel10k.git ${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/themes/powerlevel10k
  fi
}

setup_tmux() {
  install_package tmux
  if [ ! -d "$HOME/.tmux/plugins/tpm" ]; then
    git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
  fi
}

setup_nvim() {
  install_package nvim
  if [ ! -d "${XDG_CONFIG_HOME:-$HOME/.config}/nvim" ]; then
    git clone https://github.com/caiohsr14/kickstart.nvim.git "${XDG_CONFIG_HOME:-$HOME/.config}"/nvim
  fi
}

install_brew() {
  if ! command -v brew >/dev/null 2>&1; then
    echo "Installing Homebrew"
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)"
  fi
}

if [ "$system_type" = "Darwin" ]; then
  install_brew
  brew install --cask font-meslo-lg-nerd-font
else
  install_package kitty
  install_package btop
  install_package cmake
  install_package pamixer
  install_package thunar
  install_package tofi
  install_package ttf-jetbrains-mono-nerd
  install_package ttf-opensans
  install_package yazi

  install_package grimblast
  install_package hyprland
  install_package hypridle
  install_package hyprlock
  install_package hyprpaper
  install_package hyprpicker
  install_package mako
  install_package noise-suppression-for-voice
  install_package nwg-look
  install_package rnnoise
  install_package syncthing
  install_package waybar
  install_package wl-clipboard
  install_package xdg-desktop-portal-gtk
  install_package xdg-desktop-portal-hyprland

  install_package mpd
  install_package mpdscribble
  install_package mpv
  install_package obs-studio
  install_package pavucontrol
  install_package rmpc
  install_package spotify
  install_package telegram-desktop
  install_package thunderbird
  install_package vesktop-bin
  install_package vivaldi

  install_package rainfrog
  install_package sqlitebrowser
  install_package docker
  install_package docker-compose
  install_package python-uv
  install_package vim

  if [ ! -d "$HOME/.icons/catppuccin" ]; then
    mkdir -p "$HOME/.icons/catppuccin" && \
    curl -Ls https://github.com/catppuccin/cursors/releases/download/v2.0.0/catppuccin-mocha-pink-cursors.zip | \
    bsdtar -xf - --strip-components=1 -C "$HOME/.icons/catppuccin"
  fi

  if ! systemctl is-enabled --user syncthing.service >/dev/null 2>&1; then
    systemctl enable --user syncthing.service
  fi
  if ! systemctl is-active --user syncthing.service >/dev/null 2>&1; then
    systemctl start --user syncthing.service
  fi
fi

setup_zsh
setup_tmux
setup_nvim

install_package bat
install_package fzf
install_package fd
install_package eza
install_package lazygit
install_package ripgrep
install_package keepassxc
install_package zoxide

if [ -z "$(git config --global user.name)" ]; then
  git config --global user.name "Caio Rodrigues"
  git config --global user.email "caiohsr__@hotmail.com"
  git config --global pull.rebase true
  git config --global rebase.autoStash true
fi
